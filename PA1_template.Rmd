---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
Obtain the raw data file by doing the minimum work to get it. 
```{r}
zipfile <- "activity.zip"
datafile <- "activity.csv"
if (!file.exists(datafile)) {
  unzip(zipfile)
}
```

Read in the csv file, convert to a tibble (I'm a 'hadleyverse' fan!) and clean it of any NAs
```{r warning=FALSE}
suppressPackageStartupMessages(library(dplyr))
raw.data <- tbl_df(read.csv(datafile))
clean.data <- na.omit(raw.data)
```

## What is mean total number of steps taken per day?
Here is a histogram of the total number of steps taken each day
```{r}
library(ggplot2, verbose = FALSE, quietly = TRUE)
data.by_day <- group_by(clean.data, date) %>% summarize(data.by_day=sum(steps))
names(data.by_day) <- c("date", "steps")
qplot(steps, data=data.by_day, binwidth=500)
```

The mean and median number of steps taken each day are calculated thus:
```{r}
nos.mean <- mean(data.by_day$steps)
nos.median <- median(data.by_day$steps)
```
The mean and median number of steps taken each day, ignoring rows with missing data are `r nos.mean` & `r  nos.median`, respectively

## What is the average daily activity pattern?
To see the average daily activity pattern (`adap`) we're going to group by the interval, then summarize by the mean for each interval:
```{r}
adap <- group_by(clean.data, interval) %>% summarise(mean(steps))
names(adap) <- c("interval", "Steps")
qplot(interval, Steps, data=adap, geom='line')
```
The 5 minute interval that has the average most number of steps is:
```{r}
top_n(adap, 1, Steps)$interval
```
## Imputing missing values
*1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)*

To figure out the missing values (i.e. `NA`) in the data set, we convert the `raw.data` to a logical array indicating which cells are  `NA`:
```{r}
na_array <- is.na(raw.data)
```
We then apply the `any` function to each row to get a vector which is `TRUE` when any column in the corresponding row is `TRUE`; i.e. had an `NA` value in the original data set. We can count the number of such rows using `sum`, because `TRUE` is converted to a `1` and `FALSE` is converted to a `0` when doing integer arithmetic on a logical vector.
```{r}
sum(apply(na_array, 1, any))
```
So we see there are 2304 rows that contain at least one `NA`.

*2. Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.*

Firstly we need to see if the data is missing from just the `steps` column, or one of the other columns? Lets look at what happens if we sum the columns of the `na_array`:
```{r}
apply(na_array, 2, sum)
```

So we know that all the missing data is in the `steps` column. That will make things easier!

My strategy will be to simply replace missing values with the average for that interval, taken from the table `adap`, calculated earlier. 

*3. Create a new dataset that is equal to the original dataset but with the missing data filled in.*

We'll do this by doing a full join between the `raw.data` table with the `adap` table on the `interval` column. This will give us a new table with a new column `Steps` containing the average steps per interval. We can then mutate this table to create the final set of steps (in a column called `steps2`) by selecting the average steps (from the `Steps` column) if it is `NA` and the original `steps` value otherwise. We'll then select just the columns we want, and rename them to match the original `raw.data` data frame:

```{r}
imputed.data <- full_join(raw.data, adap, by=c("interval")) %>% 
  mutate(steps2=ifelse(is.na(steps), Steps, steps)) %>%
  select(steps2, date, interval) %>% rename(steps = steps2)
```


*4. Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?*

```{r}
imputed.data.by_day <- group_by(imputed.data, date) %>% summarize(imputed.data.by_day=sum(steps))
names(imputed.data.by_day) <- c("date", "steps")
qplot(steps, data=imputed.data.by_day, binwidth=500)
```

Recalculate the number of steps mean and median:
```{r}
new.nos.mean <- mean(imputed.data.by_day$steps)
new.nos.median <- median(imputed.data.by_day$steps)
```

The mean and median number of steps taken per day are `r new.nos.mean` and `r new.nos.median`.

The differences between the old and the new mean and median are `r new.nos.mean - nos.mean` and `r new.nos.median - nos.median`

So the values do differ from the original values, but not by much.

The impact of imputing missing data on the estimates of the total daily number of steps was not to change the mean but to bring the median in line with the mean.

## Are there differences in activity patterns between weekdays and weekends?
